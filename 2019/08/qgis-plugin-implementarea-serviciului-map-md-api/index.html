<!doctype html><html lang=ro><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>QGIS Plugin: Implementarea serviciului Map.md API - Sunt Programator!</title><meta name=Description content="Ãn acest blog veÈ›i cunoaÈ™te lucruri noi despre programare È™i despre lumea IT. Sunt Programator! Simte-te È™i tu mÃ¢ndru de ceea ce eÈ™ti!"><meta property="og:title" content="QGIS Plugin: Implementarea serviciului Map.md API"><meta property="og:description" content="Introducere Ãn acest articol se demonstreazÄƒ construirea unui Plugin pentru aplicaÈ›ia QGIS 3, ce foloseÈ™te serviciile Map.md API. AvÃ¢nd o experienÈ›Äƒ modestÄƒ Ã®n limbajul Python, Ã®n acest articol pot fi Ã®ntÃ¢lnite â€biciclete inventateâ€œ ğŸ˜„. Voi fi recunoscÄƒtor dacÄƒ veÈ›i oferi sfaturi cum ar fi posibil sÄƒ Ã®mbunÄƒtÄƒÈ›esc codul scris.
Ãntr-o bunÄƒ zi, navigÃ¢nd pe reÈ›eaua LinkedIn, am dat de postarea lui Roman È˜tirbu, CEO al companiei Simpals. Ãn aceastÄƒ postare, dumnealui a menÈ›ionat cÄƒ a fost lansat serviciul API al sitului Map."><meta property="og:type" content="article"><meta property="og:url" content="http://suntprogramator.dev/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/"><meta property="og:image" content="http://suntprogramator.dev/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/maxresdefault.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-04T12:09:51+00:00"><meta property="article:modified_time" content="2020-08-09T22:19:31+03:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://suntprogramator.dev/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/maxresdefault.jpg"><meta name=twitter:title content="QGIS Plugin: Implementarea serviciului Map.md API"><meta name=twitter:description content="Introducere Ãn acest articol se demonstreazÄƒ construirea unui Plugin pentru aplicaÈ›ia QGIS 3, ce foloseÈ™te serviciile Map.md API. AvÃ¢nd o experienÈ›Äƒ modestÄƒ Ã®n limbajul Python, Ã®n acest articol pot fi Ã®ntÃ¢lnite â€biciclete inventateâ€œ ğŸ˜„. Voi fi recunoscÄƒtor dacÄƒ veÈ›i oferi sfaturi cum ar fi posibil sÄƒ Ã®mbunÄƒtÄƒÈ›esc codul scris.
Ãntr-o bunÄƒ zi, navigÃ¢nd pe reÈ›eaua LinkedIn, am dat de postarea lui Roman È˜tirbu, CEO al companiei Simpals. Ãn aceastÄƒ postare, dumnealui a menÈ›ionat cÄƒ a fost lansat serviciul API al sitului Map."><meta name=application-name content="Sunt Programator!"><meta name=apple-mobile-web-app-title content="Sunt Programator!"><meta name=theme-color content="#292a2d"><meta name=msapplication-TileColor content="#ffffff"><link rel=icon href=/svg-logo.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#ffffff><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://suntprogramator.dev/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/><link rel=next href=http://suntprogramator.dev/2020/08/latex-involute-of-a-circle/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"QGIS Plugin: Implementarea serviciului Map.md API","inLanguage":"ro","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/suntprogramator.dev\/2019\/08\/qgis-plugin-implementarea-serviciului-map-md-api\/"},"image":["http:\/\/suntprogramator.dev\/Logo-512x512-circle-min.png","http:\/\/suntprogramator.dev\/logo.jpg"],"genre":"posts","keywords":"pyqgis, pyqt5, python, qgis","wordcount":4561,"url":"http:\/\/suntprogramator.dev\/2019\/08\/qgis-plugin-implementarea-serviciului-map-md-api\/","datePublished":"2019-08-04T12:09:51+00:00","dateModified":"2020-08-09T22:19:31+03:00","license":"AceastÄƒ lucrare este licenÈ›iatÄƒ Ã®n baza Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Sunt Programator!","logo":"http:\/\/suntprogramator.dev\/Logo-512x512-circle-min.png"},"author":{"@type":"Person","name":"Victor Pogor"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Sunt Programator!"><span class=header-title-pre><i class='fas fa-code fa-fw'></i></span>Sunt Programator!</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Articole </a><a class=menu-item href=/tags/>Etichete </a><a class=menu-item href=/categories/>Categorii </a><a class=menu-item href=https://github.com/sunt-programator/sunt-programator-site title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i> </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title="Selectare LimbÄƒ">RomÃ¢nÄƒ<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/ selected>RomÃ¢nÄƒ</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder="CÄƒutarea titlului sau conÈ›inutului articolului ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=CÄƒutare><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Golire><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Schimbare TemÄƒ"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Sunt Programator!"><span class=header-title-pre><i class='fas fa-code fa-fw'></i></span>Sunt Programator!</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="CÄƒutarea titlului sau conÈ›inutului articolului ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=CÄƒutare><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Golire><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Anulare</a></div><a class=menu-item href=/posts/ title>Articole</a><a class=menu-item href=/tags/ title>Etichete</a><a class=menu-item href=/categories/ title>Categorii</a><a class=menu-item href=https://github.com/sunt-programator/sunt-programator-site title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Schimbare TemÄƒ">
<i class="fas fa-adjust fa-fw"></i>
</a><a href=javascript:void(0); class=menu-item title="Selectare LimbÄƒ">RomÃ¢nÄƒ<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value"><option value=/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/ selected>RomÃ¢nÄƒ</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Cuprins</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">QGIS Plugin: Implementarea serviciului Map.md API</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://suntprogramator.dev/ title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>Victor Pogor</a></span>&nbsp;<span class=post-category>inclus Ã®n <a href=/categories/proiecte/><i class="far fa-folder fa-fw"></i>Proiecte</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2019-08-04>2019-08-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;4561 cuvinte&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;22 minute&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/maxresdefault.jpg data-srcset="/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/maxresdefault.jpg, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/maxresdefault.jpg 1.5x, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/maxresdefault.jpg 2x" data-sizes=auto alt=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/maxresdefault.jpg title=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/maxresdefault.jpg></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Cuprins</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#introducere>Introducere</a></li><li><a href=#crearea-sablonului-extensiei-qgis-qgis-plugin>Crearea È™ablonului extensiei QGIS (QGIS Plugin)</a><ul><li><a href=#generarea-È™ablonului-cu-ajutorul-extensiei-plugin-builder-3>Generarea È™ablonului cu ajutorul extensiei Plugin Builder 3</a></li><li><a href=#note-suplimentare-privind-procesul-de-generare-al-È™ablonului-extensiei>Note suplimentare privind procesul de generare al È™ablonului extensiei</a></li></ul></li><li><a href=#configurarea-mediului-de-dezvoltare-al-extensiei>Configurarea mediului de dezvoltare al extensiei</a><ul><li><a href=#pregÄƒtirea-mediului-de-dezvoltare>PregÄƒtirea mediului de dezvoltare</a></li><li><a href=#verificarea-funcÈ›ionalitÄƒÈ›ii-extensiei>Verificarea funcÈ›ionalitÄƒÈ›ii extensiei</a></li></ul></li><li><a href=#ajustarea-interfeÈ›ei-extensiei>Ajustarea interfeÈ›ei extensiei</a></li><li><a href=#crearea-clasei-destinatÄƒ-procesului-de-geocodificare>Crearea clasei destinatÄƒ procesului de geocodificare</a></li><li><a href=#lucrul-cu-fiÈ™ierul-de-intrare-È™i-cel-ce-conÈ›ine-adrese-neidentificate>Lucrul cu fiÈ™ierul de intrare È™i cel ce conÈ›ine adrese neidentificate</a><ul><li><a href=#citirea-fiÈ™ierului-de-intrare>Citirea fiÈ™ierului de intrare</a></li><li><a href=#calcularea-numÄƒrului-de-rÃ¢nduri-ale-fiÈ™ierului-de-intrare>Calcularea numÄƒrului de rÃ¢nduri ale fiÈ™ierului de intrare</a></li><li><a href=#scrierea-rÃ¢ndurilor-cu-adrese-neidentificate-Ã®n-fiÈ™ier-csv>Scrierea rÃ¢ndurilor cu adrese neidentificate Ã®n fiÈ™ier CSV</a></li></ul></li><li><a href=#utilizarea-serviciului-api-geocodificare-al-site-ului-mapmd>Utilizarea serviciului API Geocodificare al site-ului Map.md</a><ul><li><a href=#obÈ›inerea-cheii-api>ObÈ›inerea cheii API</a></li><li><a href=#implementarea-metodelor-destinate-adresÄƒrii-cÄƒtre-mapmd-api>Implementarea metodelor destinate adresÄƒrii cÄƒtre Map.md API</a></li></ul></li><li><a href=#utilizarea-bazei-de-date-spatialite-pentru-stocarea-adreselor-geocodificate>Utilizarea bazei de date SpatiaLite pentru stocarea adreselor geocodificate</a><ul><li><a href=#de-ce-spatialite>De ce SpatiaLite</a></li><li><a href=#structura-bazei-de-date-spatialite>Structura bazei de date SpatiaLite</a></li><li><a href=#proiectarea-bazei-de-date-spatialite>Proiectarea bazei de date SpatiaLite</a></li></ul></li><li><a href=#implementarea-procesului-de-geocodificare-propriu-zis>Implementarea procesului de geocodificare propriu-zis</a><ul><li><a href=#implementarea-metodelor-de-geocodificare-a-rÃ¢ndurilor-csv>Implementarea metodelor de geocodificare a rÃ¢ndurilor CSV</a></li><li><a href=#implementarea-metodei-de-rulare-a-procesului-de-geocodificare>Implementarea metodei de rulare a procesului de geocodificare</a></li><li><a href=#implementarea-metodei-de-finisare-a-procesului-de-geocodificare>Implementarea metodei de finisare a procesului de geocodificare</a></li></ul></li><li><a href=#implementarea-logicii-pentru-interfaÈ›a-dialogul-de-geocodificare>Implementarea logicii pentru interfaÈ›a dialogul de geocodificare</a><ul><li><a href=#importarea-bibliotecilor-necesare>Importarea bibliotecilor necesare</a></li><li><a href=#asigurarea-conexiunii-evenimentelor-cu-metodele-respective>Asigurarea conexiunii evenimentelor cu metodele respective</a></li><li><a href=#implementarea-metodei-de-alegere-a-fiÈ™ierului-de-intrare>Implementarea metodei de alegere a fiÈ™ierului de intrare</a></li><li><a href=#implementarea-metodei-de-alegere-a-cÄƒilor-spre-fiÈ™ierele-de-ieÈ™ire>Implementarea metodei de alegere a cÄƒilor spre fiÈ™ierele de ieÈ™ire</a></li><li><a href=#verificarea-disponibilitÄƒÈ›ii-procedurii-de-geocodificare>Verificarea disponibilitÄƒÈ›ii procedurii de geocodificare</a></li></ul></li><li><a href=#modificarea-fiÈ™ierului-principal-al-extensiei>Modificarea fiÈ™ierului principal al extensiei</a><ul><li><a href=#obÈ›inerea-datelor-din-interfaÈ›a-dialogului-extensiei-È™i-adÄƒugarea-procesului-de-geocodificare-Ã®n-managerul-de-sarcini>ObÈ›inerea datelor din interfaÈ›a dialogului extensiei È™i adÄƒugarea procesului de geocodificare Ã®n managerul de sarcini</a></li></ul></li><li><a href=#Ã®ncheire>Ãncheire</a></li></ul></nav></div></div><div class=content id=content><h2 id=introducere>Introducere</h2><p>Ãn acest articol se demonstreazÄƒ construirea unui Plugin pentru aplicaÈ›ia <a href=https://www.qgis.org/en/site/ target=_blank rel="noopener noreffer">QGIS 3</a>, ce foloseÈ™te serviciile Map.md API. AvÃ¢nd o experienÈ›Äƒ modestÄƒ Ã®n limbajul Python, Ã®n acest articol pot fi Ã®ntÃ¢lnite â€biciclete inventateâ€œ ğŸ˜„. Voi fi recunoscÄƒtor dacÄƒ veÈ›i oferi sfaturi cum ar fi posibil sÄƒ Ã®mbunÄƒtÄƒÈ›esc codul scris.</p><p>Ãntr-o bunÄƒ zi, navigÃ¢nd pe reÈ›eaua LinkedIn, am dat de <a href=https://www.linkedin.com/feed/update/urn:li:activity:6536171635165192192 target=_blank rel="noopener noreffer">postarea</a> lui Roman È˜tirbu, CEO al companiei Simpals. Ãn aceastÄƒ postare, dumnealui a menÈ›ionat cÄƒ <a href=https://map.md/ru/blog/map-md-lanseaza-setul-de-servicii-api target=_blank rel="noopener noreffer">a fost lansat</a> serviciul API al sitului Map.md pentru companii care au nevoie de integrare cu CRM sau alte soluÈ›ii IT.</p><p>Pentru mine a fost o noutate extraordinarÄƒ. OperÃ¢nd adesea cu date geospaÈ›iale, aveam nevoie de un serviciu similar pentru <a href=https://ro.wikipedia.org/wiki/Geocodificare target=_blank rel="noopener noreffer">geocodificarea</a> adreselor. Sigur cÄƒ la momentul actual existau serviciile <a href=https://developers.google.com/maps/documentation/geocoding/start target=_blank rel="noopener noreffer">Google Geocoding API</a> È™i <a href=https://nominatim.openstreetmap.org target=_blank rel="noopener noreffer">OpenStreetMap Nominatim</a>, Ã®nsÄƒ nu eram satisfÄƒcut de rezultatele obÈ›inute ale acestor servicii.</p><p>AflÃ¢nd de acest serviciu, imediat mi-a venit o idee de a-l implementa Ã®n aplicaÈ›ia QGIS, prin construirea unui <a href=https://ro.wikipedia.org/wiki/Plugin target=_blank rel="noopener noreffer">Plugin</a> ğŸ’¡. La elaborarea acestuia, m-am inspirat din extensia deja existentÄƒ <a href=https://plugins.qgis.org/plugins/mmqgis/ target=_blank rel="noopener noreffer">MMQGIS</a>. Printre multiplele funcÈ›ionalitÄƒÈ›i ce le are, acesta dispune È™i de geocodificarea adreselor prin intermediul serviciilor menÈ›ionate anterior.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube-nocookie.com/embed/_BRBshZOqd0 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h2 id=crearea-sablonului-extensiei-qgis-qgis-plugin>Crearea È™ablonului extensiei QGIS (QGIS Plugin)</h2><p>Pentru a crea È™ablonul extensiei QGIS, este nevoie de aplicaÈ›ia propriu-zisÄƒ <a href=https://www.giscourse.com/install-qgis-through-osgeo4w/ target=_blank rel="noopener noreffer">instalatÄƒ</a> Ã®n calculator È™i de extensiile <a href=http://plugins.qgis.org/plugins/pluginbuilder/ target=_blank rel="noopener noreffer">Plugin Builder 3</a>, <a href=https://plugins.qgis.org/plugins/debug_vs/ target=_blank rel="noopener noreffer">debugvs</a> È™i <a href=https://plugins.qgis.org/plugins/plugin_reloader/ target=_blank rel="noopener noreffer">Plugin Reloader</a>.</p><h3 id=generarea-È™ablonului-cu-ajutorul-extensiei-plugin-builder-3>Generarea È™ablonului cu ajutorul extensiei Plugin Builder 3</h3><p>La pornirea acestei aplicaÈ›ii navigÄƒm meniul <code>Plugins â–º Plugin Builder â–º Plugin Builder</code>.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/1-min.png data-srcset="/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/1-min.png, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/1-min.png 1.5x, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/1-min.png 2x" data-sizes=auto alt=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/1-min.png title="InterfaÈ›a aplicaÈ›iei QGIS 3."></p><p>DupÄƒ afiÈ™area dialogului, completÄƒm forma cu <a href=http://geoapt.net/pluginbuilder/ target=_blank rel="noopener noreffer">detaliile</a> referitoare la extensie.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2-min.png data-srcset="/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2-min.png, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2-min.png 1.5x, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2-min.png 2x" data-sizes=auto alt=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2-min.png title="Dialogul extensiei QGIS Plugin Builder."></p><p>ApÄƒsÃ¢nd butonul next, introducem informaÈ›ia detailatÄƒ privind extensia QGIS, È™ablonul cÄƒreia urmeazÄƒ a fi creat.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/4.png data-srcset="/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/4.png, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/4.png 1.5x, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/4.png 2x" data-sizes=auto alt=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/4.png title="Forma unde se introduce informaÈ›ia detailatÄƒ privind extensia QGIS."></p><p>Ãn urmÄƒtoarea formÄƒ, alegem È™ablonul <code>Tool button with dialog</code>, meniul <code>Plugins</code> È™i numele elementului meniului, spre exemplu, <code>MapMD</code>.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/5-min.png data-srcset="/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/5-min.png, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/5-min.png 1.5x, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/5-min.png 2x" data-sizes=auto alt=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/5-min.png title="Forma unde se introduce informaÈ›ia privind tipul È™ablonului."></p><p>SÄƒrind la urmÄƒtorul pas, selectÄƒm toate opÈ›iunile, pentru a avea o funcÈ›ionalitate mai vastÄƒ a extensiei.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/6.png data-srcset="/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/6.png, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/6.png 1.5x, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/6.png 2x" data-sizes=auto alt=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/6.png title="Forma unde se alege opÈ›iunile extensiei."></p><p>La urmÄƒtorul pas, suplinim forma privind publicarea extensiei. Pentru aceasta, eu am creat prealabil un <a href=https://github.com/victor-pogor/map.md-geocoding target=_blank rel="noopener noreffer">repository</a> pe Github È™i am introdus datele indicate Ã®n imaginea de mai jos. Plus la aceasta, am marcat extensia datÄƒ ca experimentalÄƒ, deoarece aceasta se va afla la starea de development È™i va fi instabilÄƒ la Ã®nceput.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/7.png data-srcset="/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/7.png, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/7.png 1.5x, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/7.png 2x" data-sizes=auto alt=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/7.png title="Forma unde se suplinesc cÃ¢mpurile privind publicarea extensiei."></p><p>La ultimul pas, alegem mapa unde va fi generat proiectul È™i apÄƒsÄƒm butonul <code>Generate</code>.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/8-min.png data-srcset="/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/8-min.png, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/8-min.png 1.5x, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/8-min.png 2x" data-sizes=auto alt=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/8-min.png title="Forma unde se alege mapa unde va fi generat proiectul extensiei."></p><h3 id=note-suplimentare-privind-procesul-de-generare-al-È™ablonului-extensiei>Note suplimentare privind procesul de generare al È™ablonului extensiei</h3><p><strong>NotÄƒ</strong>: Pentru a putea face development È™i debugging este necesar ca proiectul cu extensie sÄƒ fie localizat aici:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl><span class=nv>%APPDATA%</span>\QGIS\QGIS3\profiles\default\python\plugins\map_md_geocoding
</span></span></code></pre></td></tr></table></div></div><p>Ãn caz cÄƒ se afiÈ™eazÄƒ avertizare <code>The resource compiler pyrccc5 was not found in your path</code>, omitem È™i primim o instrucÈ›ie cu paÈ™ii ulteriori pentru a avea posibilitatea dezvolta cu succes extensia.</p><h2 id=configurarea-mediului-de-dezvoltare-al-extensiei>Configurarea mediului de dezvoltare al extensiei</h2><p>Pentru dezvoltarea extensiei, este nevoie de configurat mediul de dezvoltare. Ãn acest scop, folosesc sistemul de operare Windows 10 È™i editorul <a href=https://code.visualstudio.com/ target=_blank rel="noopener noreffer">Visual Studio Code</a>.</p><h3 id=pregÄƒtirea-mediului-de-dezvoltare>PregÄƒtirea mediului de dezvoltare</h3><p>Ãn mapa cu extensia datÄƒ creÄƒm un fiÈ™ier cu denumirea <code>start_vscode.cmd</code> È™i scrim instrucÈ›iunile de mai jos. De fiecare datÄƒ cÃ¢nd va fi necesar de dezvoltat extensia, vom rula acest fiÈ™ier. Acest fiÈ™ier seteazÄƒ <a href=https://www.digitalcitizen.ro/content/intrebari-simple-ce-sunt-variabilele-mediu-windows target=_blank rel="noopener noreffer">variabilele de mediu</a> necesare pentru dezvoltarea È™i debugging-ul extensiei È™i, ulterior, lanseazÄƒ editorul VS Code.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl><span class=k>SET</span> <span class=nv>OSGEO4W_ROOT</span><span class=p>=</span>C:\OSGeo4W64
</span></span><span class=line><span class=cl><span class=k>call</span> <span class=s2>&#34;</span><span class=nv>%OSGEO4W_ROOT%</span><span class=s2>&#34;</span>\bin\o4w_env.bat
</span></span><span class=line><span class=cl><span class=k>call</span> <span class=s2>&#34;</span><span class=nv>%OSGEO4W_ROOT%</span><span class=s2>&#34;</span>\bin\qt5_env.bat
</span></span><span class=line><span class=cl><span class=k>call</span> <span class=s2>&#34;</span><span class=nv>%OSGEO4W_ROOT%</span><span class=s2>&#34;</span>\bin\py3_env.bat
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>path</span> <span class=nv>%PATH%</span>;<span class=nv>%OSGEO4W_ROOT%</span>\apps\qgis\bin
</span></span><span class=line><span class=cl><span class=k>path</span> <span class=nv>%PATH%</span>;<span class=nv>%OSGEO4W_ROOT%</span>\apps\Qt5\bin
</span></span><span class=line><span class=cl><span class=k>path</span> <span class=nv>%PATH%</span>;<span class=nv>%OSGEO4W_ROOT%</span>\apps\Python37\Scripts
</span></span><span class=line><span class=cl><span class=k>path</span> <span class=nv>%PATH%</span>;C:\Program Files\7-Zip
</span></span><span class=line><span class=cl><span class=k>path</span> <span class=nv>%PATH%</span>;C:\Program Files\Git\cmd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>PYTHONPATH</span><span class=p>=</span><span class=nv>%PYTHONPATH%</span>;<span class=nv>%OSGEO4W_ROOT%</span>\apps\qgis\python\
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>PYTHONPATH</span><span class=p>=</span><span class=nv>%PYTHONPATH%</span>;<span class=nv>%OSGEO4W_ROOT%</span>\apps\qgis\python\qgis
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>PYTHONPATH</span><span class=p>=</span><span class=nv>%PYTHONPATH%</span>;<span class=nv>%OSGEO4W_ROOT%</span>\apps\qgis\python\qgis\PyQt5
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>PYTHONPATH</span><span class=p>=</span><span class=nv>%PYTHONPATH%</span>;<span class=nv>%OSGEO4W_ROOT%</span>\apps\qgis\python\qgis\core
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>set</span> <span class=nv>PYTHONHOME</span><span class=p>=</span><span class=nv>%OSGEO4W_ROOT%</span>\apps\Python37
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>start</span> <span class=s2>&#34;VS Code with PyQGIS and OsGeo4W&#34;</span> /B <span class=s2>&#34;</span><span class=nv>%LOCALAPPDATA%</span><span class=s2>\Programs\Microsoft VS Code\Code.exe&#34;</span> .
</span></span></code></pre></td></tr></table></div></div><p>Ãn VS Code, creÄƒm un nou fiÈ™ier Ã®n mapa generatÄƒ a extensiei cu denumirea <code>requirements.txt</code> È™i introducem Ã®n el pachetele necesare pentru instalare Ã®n mediul virtual:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-requirements.txt data-lang=requirements.txt><span class=line><span class=cl>autopep8
</span></span><span class=line><span class=cl>pb_tool
</span></span><span class=line><span class=cl>ptvsd
</span></span><span class=line><span class=cl>sphinx_rtd_theme
</span></span></code></pre></td></tr></table></div></div><p>Ulterior, instalÄƒm aceste pachete, efectuÃ¢nd urmÄƒtoarea instrucÈ›iune:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>pip install -r requirements.txt
</span></span></code></pre></td></tr></table></div></div><p>AvÃ¢nd pachetele necesare instalate, compilÄƒm resursele aplicaÈ›iei prin efectuarea instrucÈ›iunii de mai jos. Aceasta va genera fiÈ™ierul <code>resources.py</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>pb_tool compile
</span></span></code></pre></td></tr></table></div></div><h3 id=verificarea-funcÈ›ionalitÄƒÈ›ii-extensiei>Verificarea funcÈ›ionalitÄƒÈ›ii extensiei</h3><p>Pentru a verifica dacÄƒ totul funcÈ›ioneazÄƒ bine, lansÄƒm proiectul prin executarea instrucÈ›iunii de mai jos. Aceasta trebuie sa compileze proiectul È™i sÄƒ-l copie Ã®n mapa cu extensiile QGIS.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>pb_tool deploy
</span></span></code></pre></td></tr></table></div></div><p>DupÄƒ, pornim aplicaÈ›ia QGIS È™i activÄƒm extensia noastrÄƒ prin navigarea meniului <code>Plugins â–º Manage and Install Plugins... â–º Installed â–º MapMD</code>. Ulterior, pornim extensia creatÄƒ prin apÄƒsarea butonului corespunzÄƒtor de pe bara de instrumente.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2019-06-30_8-33-08-min.png data-srcset="/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2019-06-30_8-33-08-min.png, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2019-06-30_8-33-08-min.png 1.5x, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2019-06-30_8-33-08-min.png 2x" data-sizes=auto alt=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2019-06-30_8-33-08-min.png title="Fereastra extensiei ce conÈ›ine numai douÄƒ butoane."></p><h2 id=ajustarea-interfeÈ›ei-extensiei>Ajustarea interfeÈ›ei extensiei</h2><p>Pentru a adÄƒuga elemente Ã®n interfaÈ›a extensiei, este necesar de a rula aplicaÈ›ia Qt Designer. Aceasta o gÄƒsiÈ›i pe urmÄƒtoarea cale <code>C:\OSGeo4W64\bin\qgis-designer.bat</code>.</p><p>Apoi, deschideÈ›i cu ajutorul acestei aplicaÈ›ii fiÈ™ierul <code>map_md_dialog_base.ui</code> ce se aflÄƒ Ã®n mapa cu proiectul extensiei, adÄƒugaÈ›i componentele necesare È™i salvaÈ›i fiÈ™ierul, ca urmare fereastra sÄƒ arate Ã®n felul urmÄƒtor:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2019-06-30_8-57-17-compressor.png data-srcset="/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2019-06-30_8-57-17-compressor.png, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2019-06-30_8-57-17-compressor.png 1.5x, /images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2019-06-30_8-57-17-compressor.png 2x" data-sizes=auto alt=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/2019-06-30_8-57-17-compressor.png title="Ajustarea interfeÈ›ei extensiei."></p><h2 id=crearea-clasei-destinatÄƒ-procesului-de-geocodificare>Crearea clasei destinatÄƒ procesului de geocodificare</h2><p>Pentru a implementa funcÈ›ionalitÄƒÈ›ile extensiei, metodele ulterioare le-am inclus Ã®ntr-o clasÄƒ distinctÄƒ care va fi moÈ™tenitÄƒ de la clasa <a href=https://qgis.org/pyqgis/3.0/core/Task/QgsTask.html target=_blank rel="noopener noreffer">QgsTask</a>. AceastÄƒ clasÄƒ permite ca procesul de geocodificare sÄƒ fie adÄƒugat Ã®n managerul de sarcini al aplicaÈ›iei QGIS, cu alte cuvinte extensia nu va bloca interfaÈ›a aplicaÈ›iei geospaÈ›iale È™i procesul de geocodificare va putea fi Ã®ntrerupt la cererea utilizatorul, ca rezultat afiÈ™Ã¢ndu-se numai adresele geocodificare pÃ¢nÄƒ la aceastÄƒ Ã®ntrerupere.</p><p>Ãn aceastÄƒ clasÄƒ am importat bibliotecile necesare È™i am declarat variabilele cu care voi opera pe parcurs, denumirea celor private Ã®ncepÃ¢ndu-se cu douÄƒ simboluri <em>underscore</em> (â€_â€). Constructorul clasei conÈ›ine argumente cu valori implicite care sunt opÈ›ionale.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>csv</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>codecs</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sqlite3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.parse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>shapely</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>shapely.geometry</span> <span class=kn>import</span> <span class=n>shape</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># pylint: disable=import-error</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>qgis.utils</span> <span class=kn>import</span> <span class=n>iface</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>qgis.core</span> <span class=kn>import</span> <span class=p>(</span><span class=n>QgsDataSourceUri</span><span class=p>,</span> <span class=n>Qgis</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                       <span class=n>QgsTask</span><span class=p>,</span> <span class=n>QgsMessageLog</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># pylint: enable=import-error</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Clasa moÈ™tenitÄƒ de la clasa QgsTask,</span>
</span></span><span class=line><span class=cl><span class=c1># ce permite adÄƒugarea sarcinii de geocodificare Ã®n</span>
</span></span><span class=line><span class=cl><span class=c1># managerul de sarcini al aplicaÈ›iei Qgis.</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MapMdUtils</span><span class=p>(</span><span class=n>QgsTask</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>input_filename</span><span class=p>,</span> <span class=n>output_filename</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=n>notfound_filename</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=n>street1_index</span><span class=o>=-</span><span class=mi>1</span><span class=p>,</span> <span class=n>street2_index</span><span class=o>=-</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=n>house_number_index</span><span class=o>=-</span><span class=mi>1</span><span class=p>,</span> <span class=n>locality_index</span><span class=o>=-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Se apeleazÄƒ constructorul clasei QgsTask,</span>
</span></span><span class=line><span class=cl>        <span class=c1># unde se introduce denumirea sarcinii È™i abilitatea de a</span>
</span></span><span class=line><span class=cl>        <span class=c1># Ã®ntrerupe procesul de geocodificare.</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=s2>&#34;Geocodificarea adreselor&#34;</span><span class=p>,</span> <span class=n>QgsTask</span><span class=o>.</span><span class=n>CanCancel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__api_key</span> <span class=o>=</span> <span class=n>api_key</span> <span class=c1># Cheia API</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__street1_index</span> <span class=o>=</span> <span class=n>street1_index</span> <span class=c1># Indicele coloanei Strada1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__street2_index</span> <span class=o>=</span> <span class=n>street2_index</span> <span class=c1># Indicele coloanei Strada2</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__house_number_index</span> <span class=o>=</span> <span class=n>house_number_index</span> <span class=c1># Indicele coloanei numÄƒrul casei</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__locality_index</span> <span class=o>=</span> <span class=n>locality_index</span> <span class=c1># Indicele coloanei Localitate</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__input_filename</span> <span class=o>=</span> <span class=n>input_filename</span> <span class=c1># Calea spre fiÈ™ierul de intrare</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__output_filename</span> <span class=o>=</span> <span class=n>output_filename</span> <span class=c1># Calea spre fiÈ™ierul de ieÈ™ire</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__notfound_filename</span> <span class=o>=</span> <span class=n>notfound_filename</span> <span class=c1># Calea spre fiÈ™ierul cu adrese neidentificate</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__table_name</span> <span class=o>=</span> <span class=s2>&#34;point_geometry&#34;</span> <span class=c1># Denumirea tabelului SpatiaLite (SQLite)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__header</span> <span class=o>=</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__quote_identifier</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span><span class=p>)</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=nb>next</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>read_csv</span><span class=p>())]</span> <span class=c1># Denumirile coloanelor</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__not_found_count</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1># Cantitatea adreselor neidentificate</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>exception</span> <span class=o>=</span> <span class=kc>None</span> <span class=c1># ExcepÈ›ia returnatÄƒ Ã®n urma geocodificÄƒrii</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=lucrul-cu-fiÈ™ierul-de-intrare-È™i-cel-ce-conÈ›ine-adrese-neidentificate>Lucrul cu fiÈ™ierul de intrare È™i cel ce conÈ›ine adrese neidentificate</h2><h3 id=citirea-fiÈ™ierului-de-intrare>Citirea fiÈ™ierului de intrare</h3><p>Pentru citirea fiÈ™ierului de intrare, care trebuie sÄƒ fie de tip CSV cu codificarea UTF-8, eu am creat o metodÄƒ care va citi rÃ¢nd cu rÃ¢nd acest fiÈ™ier, iar Ã®n caz cÄƒ va surveni o excepÈ›ie, aceasta va fi afiÈ™atÄƒ Ã®n bara de mesaje ale aplicaÈ›iei geospaÈ›iale QGIS.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>read_csv</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Read CSV file. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__input_filename</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>csvfile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Identify CSV dialect (delimiter)</span>
</span></span><span class=line><span class=cl>            <span class=n>dialect</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>Sniffer</span><span class=p>()</span><span class=o>.</span><span class=n>sniff</span><span class=p>(</span><span class=n>csvfile</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=mi>4096</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>csvfile</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>reader</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>reader</span><span class=p>(</span><span class=n>csvfile</span><span class=p>,</span> <span class=n>dialect</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>reader</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=n>row</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>IOError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>iface</span><span class=o>.</span><span class=n>messageBar</span><span class=p>()</span><span class=o>.</span><span class=n>pushCritical</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Input CSV File&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Failure opening &#34;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>__input_filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>UnicodeDecodeError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>iface</span><span class=o>.</span><span class=n>messageBar</span><span class=p>()</span><span class=o>.</span><span class=n>pushCritical</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Input CSV File&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Bad CSV file - Unicode decode error&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>csv</span><span class=o>.</span><span class=n>Error</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>iface</span><span class=o>.</span><span class=n>messageBar</span><span class=p>()</span><span class=o>.</span><span class=n>pushCritical</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Input CSV File&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Bad CSV file - verify that your delimiters are consistent&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=calcularea-numÄƒrului-de-rÃ¢nduri-ale-fiÈ™ierului-de-intrare>Calcularea numÄƒrului de rÃ¢nduri ale fiÈ™ierului de intrare</h3><p>Pentru ca Ã®n aplicaÈ›ia QGIS sÄƒ fie afiÈ™at procentajul de Ã®ndeplinirii a sarcinii de geocodificare, eu am creat o metodÄƒ pentru calcularea numÄƒrului de rÃ¢nduri ale fiÈ™ierului de intrare de tip CSV.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>__count_csv_lines</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Count CSV lines. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__input_filename</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>csvfile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>csvfile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>csv</span><span class=o>.</span><span class=n>Error</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>iface</span><span class=o>.</span><span class=n>messageBar</span><span class=p>()</span><span class=o>.</span><span class=n>pushCritical</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Input CSV File&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Bad CSV file - verify that your delimiters are consistent&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=scrierea-rÃ¢ndurilor-cu-adrese-neidentificate-Ã®n-fiÈ™ier-csv>Scrierea rÃ¢ndurilor cu adrese neidentificate Ã®n fiÈ™ier CSV</h3><p>Ãn caz cÄƒ adresele indicate Ã®n fiÈ™ierul de intrare nu au fost posibil de geocodificat, extensia datÄƒ copie Ã®ntregul rÃ¢nd ce conÈ›ine adresa neidentificatÄƒ Ã®n fiÈ™ierul de ieÈ™ire care, la fel, reprezintÄƒ un fiÈ™ier CSV cu codificarea UTF-8 È™i incrementeazÄƒ numÄƒrul de adrese neidentificate care la final de process va fi afiÈ™at Ã®n aplicaÈ›ia QGIS.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>__write_notfound_street_to_csv</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>row</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Write not found street to CSV file.
</span></span></span><span class=line><span class=cl><span class=s2>    param line: Line to be written in CSV file.
</span></span></span><span class=line><span class=cl><span class=s2>    type line: str
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__notfound_filename</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=n>newline</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>csvfile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>csv_writter</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>writer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>csvfile</span><span class=p>,</span> <span class=n>delimiter</span><span class=o>=</span><span class=s1>&#39;,&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>quotechar</span><span class=o>=</span><span class=s1>&#39;&#34;&#39;</span><span class=p>,</span> <span class=n>quoting</span><span class=o>=</span><span class=n>csv</span><span class=o>.</span><span class=n>QUOTE_MINIMAL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>csv_writter</span><span class=o>.</span><span class=n>writerow</span><span class=p>(</span><span class=n>row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>__not_found_count</span> <span class=o>+=</span> <span class=mi>1</span> <span class=c1># Increment pentru cantitatea adreselor neidentificate</span>
</span></span><span class=line><span class=cl>    <span class=c1># Se expediazÄƒ cÄƒtre aplicaÈ›ia QGIS log cÄƒ adresa nu a fost identificatÄƒ.</span>
</span></span><span class=line><span class=cl>    <span class=n>QgsMessageLog</span><span class=o>.</span><span class=n>logMessage</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Nu a fost geocodificat rÃ¢ndul CSV: </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=s1>&#39;,&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>row</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>level</span><span class=o>=</span><span class=n>Qgis</span><span class=o>.</span><span class=n>Warning</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=utilizarea-serviciului-api-geocodificare-al-site-ului-mapmd>Utilizarea serviciului API Geocodificare al site-ului Map.md</h2><p>Pentru a utiliza serviciul API Geocodificare al site-ului Map.md API, este nevoie de a obÈ›ine cheia API ğŸ”‘.</p><h3 id=obÈ›inerea-cheii-api>ObÈ›inerea cheii API</h3><p>Pentru a utiliza serviciul API Geocodificare, este necesar de obÈ›inut un cod unic de identificare. Pentru aceasta, este necesar sÄƒ ne conectÄƒm la sistemul Simpals-ID, utilizÃ¢nd login-ul sau parola contului pentru oricare dintre proiectele companiei.</p><p>Apoi, accesÄƒm link-ul <a href=https://map.md/ru/api target=_blank rel="noopener noreffer">map.md/ro/api</a>, facem click pe butonul <code>ObÈ›ineÈ›i codul</code>, completÄƒm formularul special È™i salvÄƒm codul rezultat.</p><p>InformaÈ›ia detailatÄƒ privind obÈ›inerea cheii API o puteÈ›i gÄƒsi Ã®n <a href=https://map.md/ro/blog/map-md-lanseaza-setul-de-servicii-api target=_blank rel="noopener noreffer">acest articol</a>.</p><h3 id=implementarea-metodelor-destinate-adresÄƒrii-cÄƒtre-mapmd-api>Implementarea metodelor destinate adresÄƒrii cÄƒtre Map.md API</h3><p>Pentru a geocodifica adresele conÈ›inute Ã®n fiÈ™ierul de intrare, eu am realizat 3 metode care vor rÄƒspunde de:</p><ul><li>cÄƒutarea È™i obÈ›inerea identificatorului strÄƒzii;</li><li>obÈ›inerea datelor geospaÈ›iale ale strÄƒzii; È™i</li><li>obÈ›inerea datelor geospaÈ›iale ale strÄƒzii cu numÄƒrul casei indicat.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>__map_md_search_street</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>row</span><span class=p>,</span> <span class=n>street</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Map.md search street method.
</span></span></span><span class=line><span class=cl><span class=s2>    param row: Row list.
</span></span></span><span class=line><span class=cl><span class=s2>    type row: list of str
</span></span></span><span class=line><span class=cl><span class=s2>    param street: Street.
</span></span></span><span class=line><span class=cl><span class=s2>    type street: str
</span></span></span><span class=line><span class=cl><span class=s2>    :return: False or JSON
</span></span></span><span class=line><span class=cl><span class=s2>    :rtype: dict of str
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Se obÈ›ine denumirea localitÄƒÈ›ii din rÃ¢ndul CSV.</span>
</span></span><span class=line><span class=cl>    <span class=n>locality</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__locality_index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Se face cerere cÄƒtre Map.md API, pentru a obÈ›ine</span>
</span></span><span class=line><span class=cl>    <span class=c1># identificatorul strÄƒzii.</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;https://map.md/api/companies/webmap/search_street?&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;location=</span><span class=si>%s</span><span class=s2>&amp;q=</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>locality</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                                <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>street</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>auth</span><span class=o>=</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__api_key</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># DacÄƒ nu a fost gÄƒsitÄƒ strada sau a fost returnatÄƒ o eroare,</span>
</span></span><span class=line><span class=cl>    <span class=c1># rÃ¢ndul se scrie Ã®n fiÈ™ierul cu adrese neidentificate È™i</span>
</span></span><span class=line><span class=cl>    <span class=c1># metoda returneazÄƒ False.</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>r</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__write_notfound_street_to_csv</span><span class=p>(</span><span class=n>row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>__map_md_get_street</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>street_id</span><span class=p>,</span> <span class=n>row</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Map.md get street method.
</span></span></span><span class=line><span class=cl><span class=s2>    param street_id: The Map.md street id.
</span></span></span><span class=line><span class=cl><span class=s2>    type street_id: int
</span></span></span><span class=line><span class=cl><span class=s2>    param row: Row list.
</span></span></span><span class=line><span class=cl><span class=s2>    type row: list of str
</span></span></span><span class=line><span class=cl><span class=s2>    :return: False or JSON
</span></span></span><span class=line><span class=cl><span class=s2>    :rtype: dict of str
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Se obÈ›ine denumirea localitÄƒÈ›ii din rÃ¢ndul CSV.</span>
</span></span><span class=line><span class=cl>    <span class=n>locality</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__locality_index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1># Se face cerere cÄƒtre Map.md API, pentru a obÈ›ine datele</span>
</span></span><span class=line><span class=cl>    <span class=c1># geospaÈ›iale ale strÄƒzii.</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;https://map.md/api/companies/webmap/get_street?&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;id=</span><span class=si>%s</span><span class=s2>&amp;location=</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>street_id</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                                <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>locality</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>auth</span><span class=o>=</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__api_key</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># DacÄƒ nu a fost gÄƒsitÄƒ strada sau a fost returnatÄƒ o eroare,</span>
</span></span><span class=line><span class=cl>    <span class=c1># rÃ¢ndul se scrie Ã®n fiÈ™ierul cu adrese neidentificate È™i</span>
</span></span><span class=line><span class=cl>    <span class=c1># metoda returneazÄƒ False.</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>r</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__write_notfound_street_to_csv</span><span class=p>(</span><span class=n>row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>__map_md_search_street_with_house_number</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>row</span><span class=p>,</span> <span class=n>street_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                <span class=n>house_number</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Map.md search street with house number method.
</span></span></span><span class=line><span class=cl><span class=s2>    param row: Row list.
</span></span></span><span class=line><span class=cl><span class=s2>    type row: list of str
</span></span></span><span class=line><span class=cl><span class=s2>    param house_number: House number.
</span></span></span><span class=line><span class=cl><span class=s2>    type house_number: str
</span></span></span><span class=line><span class=cl><span class=s2>    :return: False or JSON
</span></span></span><span class=line><span class=cl><span class=s2>    :rtype: dict of str
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Se face cerere cÄƒtre Map.md API, pentru a obÈ›ine datele</span>
</span></span><span class=line><span class=cl>    <span class=c1># geospaÈ›iale ale strÄƒzii È™i numÄƒrului casei.</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;https://map.md/api/companies/webmap/get_street?&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;id=</span><span class=si>%s</span><span class=s2>&amp;number=</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>street_id</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                                <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>house_number</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>auth</span><span class=o>=</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__api_key</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># DacÄƒ nu a fost gÄƒsitÄƒ strada È™i numÄƒrul casei sau a fost</span>
</span></span><span class=line><span class=cl>    <span class=c1># returnatÄƒ o eroare, rÃ¢ndul se scrie Ã®n fiÈ™ierul cu adrese</span>
</span></span><span class=line><span class=cl>    <span class=c1># neidentificate È™i metoda returneazÄƒ False.</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>r</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__write_notfound_street_to_csv</span><span class=p>(</span><span class=n>row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=utilizarea-bazei-de-date-spatialite-pentru-stocarea-adreselor-geocodificate>Utilizarea bazei de date SpatiaLite pentru stocarea adreselor geocodificate</h2><h3 id=de-ce-spatialite>De ce SpatiaLite</h3><p>Extensia MMQGIS, care a servit drept sursÄƒ de inspiraÈ›ie, salveazÄƒ adresele geocodificate Ã®ntr-un fiÈ™ier (ba chiar Ã®n mai multe ğŸ˜) cu extensia <a href=https://en.wikipedia.org/wiki/Shapefile target=_blank rel="noopener noreffer">ShapeFile</a> (*<em>.shp</em>).</p><p>AceastÄƒ metodÄƒ de a salva adresele geocodificate nu este favorabilÄƒ deoarece acest tip de fiÈ™ier are urmÄƒtoarele <a href=https://en.wikipedia.org/wiki/Shapefile#Limitations target=_blank rel="noopener noreffer">limite</a> È™i dezavantaje:</p><ul><li>Lungimea denumirii coloanelor nu poate depÄƒÈ™i 10 caractere;</li><li>Suport slab a codificÄƒrii Unicode;</li><li>Pe lÃ¢ngÄƒ fiÈ™ierul cu extensia_<em>.shp_, Ã®n aceeaÈ™i mapÄƒ se mai stocheazÄƒ È™i <a href=http://desktop.arcgis.com/en/arcmap/latest/manage-data/shapefiles/geoprocessing-considerations-for-shapefile-output.htm#GUID-D880FCB5-066A-4639-BC18-160A8FEB36A3 target=_blank rel="noopener noreffer">alte fiÈ™iere cu diverse extensii</a> (_</em>.dbf_, <em>*.prj</em>, <em>*.qpj</em>, <em>*.shx</em>, etc.).</li></ul><p>OperÃ¢nd adesea cu date geospaÈ›iale, Ã®n ultimul timp le salvam, prin intermediul aplicaÈ›iei QGIS, Ã®n baze de date de tip SpatiaLite, care reprezintÄƒ nu altceva, decÃ¢t baze de date de tip SQLite cu date geospaÈ›iale.</p><p>AplicaÈ›ia QGIS permite de a manipula aceste baze de date, salvÃ¢nd o mulÈ›ime de straturi ale aplicaÈ›iei Ã®ntr-un singur fiÈ™ier. Super! E ceea de ce am nevoie! ğŸ¤—</p><p>Problema consta Ã®n aceea, cÄƒ cu baze de date de tip SQL reuÈ™isem sÄƒ operez la un nivel superficial, Ã®nsÄƒ nu aveam idee cum sÄƒ proiectez baze de date de tip SpatiaLite.</p><p>NavigÃ¢nd pe Internet am gÄƒsit urmÄƒtoarea <a href=https://www.gaia-gis.it/gaia-sins/spatialite-cookbook/index.html#common target=_blank rel="noopener noreffer">serie de articole</a> care explicÄƒ clar cum funcÈ›ioneazÄƒ aceastÄƒ bazÄƒ de date. Minunat! E timpul pentru experimente ğŸ§ªğŸ’¡.</p><h3 id=structura-bazei-de-date-spatialite>Structura bazei de date SpatiaLite</h3><p>Baza de date de tip SpatiaLite trebuie sÄƒ conÈ›inÄƒ un tabel destinat pentru salvarea datelor geospaÈ›iale ğŸŒ.</p><p>Baza de date È™i tabelul vor fi create la Ã®nceputul geocodificÄƒrii adreselor, adÄƒugÃ¢ndu-se coloanele tabelului Ã®n strictÄƒ corespundere cu coloanele din fiÈ™ierul de intrare de tip CSV. Ulterior, se mai adaugÄƒ o coloanÄƒ ce conÈ›ine date geospaÈ›iale, Ã®n cazul dat, de tip <em>Point</em> cu geoproiecÈ›ia <a href=https://en.wikipedia.org/wiki/World_Geodetic_System target=_blank rel="noopener noreffer">WGS84 (4326)</a> ğŸŒ.</p><p>La final, este necesar de creat index pentru cheia primarÄƒ È™i pentru coloana cu date geospaÈ›iale, pentru a Ã®mbunÄƒtÄƒÈ›i performanÈ›a bazei de date ğŸ“ˆ.</p><h3 id=proiectarea-bazei-de-date-spatialite>Proiectarea bazei de date SpatiaLite</h3><p>Modalitatea de iniÈ›iere a bazei de date, creÄƒrii tabelului pentru adrese geocodificate È™i a index-urilor este indicatÄƒ Ã®n metoda de mai jos.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>__init_spatialite_db</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Init SpatiaLite database.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__output_filename</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>enable_load_extension</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>load_extension</span><span class=p>(</span><span class=s2>&#34;mod_spatialite&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;SELECT InitSpatialMetaData(1);&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS </span><span class=si>%s</span><span class=s2> (
</span></span></span><span class=line><span class=cl><span class=s2>                        PointId INTEGER NOT NULL
</span></span></span><span class=line><span class=cl><span class=s2>                        PRIMARY KEY AUTOINCREMENT);&#34;&#34;&#34;</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>__table_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;CREATE UNIQUE INDEX IF NOT EXISTS
</span></span></span><span class=line><span class=cl><span class=s2>                        idx_</span><span class=si>%s</span><span class=s2>_id ON
</span></span></span><span class=line><span class=cl><span class=s2>                        </span><span class=si>%s</span><span class=s2> (PointId);&#34;&#34;&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__table_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                            <span class=bp>self</span><span class=o>.</span><span class=n>__table_name</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;PRAGMA table_info(&#39;</span><span class=si>%s</span><span class=s2>&#39;);&#34;</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>__table_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>db_columns</span> <span class=o>=</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>db_columns</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>db_columns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>db_columns</span> <span class=o>=</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__quote_identifier</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>db_columns</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>column</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>__header</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Se adauga coloanele care nu au existat anterior</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>column</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>db_columns</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;ALTER TABLE </span><span class=si>%s</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>                                ADD COLUMN </span><span class=si>%s</span><span class=s2> TEXT&#34;&#34;&#34;</span> <span class=o>%</span>
</span></span><span class=line><span class=cl>                                <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__table_name</span><span class=p>,</span> <span class=n>column</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Se adauga coloana ce contine date geospatiale</span>
</span></span><span class=line><span class=cl>        <span class=c1># cu geoproiectia WSG 84 (4326)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s2>&#34;Geometry&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>db_columns</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;&#34;&#34;SELECT AddGeometryColumn(
</span></span></span><span class=line><span class=cl><span class=s2>                    &#39;point_geometry&#39;, &#39;Geometry&#39;,
</span></span></span><span class=line><span class=cl><span class=s2>                    4326, &#39;POINT&#39;, &#39;XY&#39;);&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># Se adauga index geospatial</span>
</span></span><span class=line><span class=cl>            <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;SELECT CreateSpatialIndex(&#39;point_geometry&#39;, &#39;Geometry&#39;);&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Ãn fragmentul de cod ce urmeazÄƒ, este realizatÄƒ funcÈ›ionalitatea de adÄƒugare a rÃ¢ndului CSV, ce a fost geocodificat cu succes, Ã®n tabelul bazei de date SpatiaLite È™i adÄƒugarea coordinatelor punctului unde este localizatÄƒ adresa sau intersecÈ›ia.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>__add_row_to_db</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>row</span><span class=p>,</span> <span class=n>geometry</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Add CSV row to database.
</span></span></span><span class=line><span class=cl><span class=s2>        param csv_row: CSV row.
</span></span></span><span class=line><span class=cl><span class=s2>        type csv_row: list of str
</span></span></span><span class=line><span class=cl><span class=s2>        param geometry: Point geometry.
</span></span></span><span class=line><span class=cl><span class=s2>        type geometry: str
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__output_filename</span><span class=p>)</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>enable_load_extension</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>load_extension</span><span class=p>(</span><span class=s2>&#34;mod_spatialite&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Insert it.</span>
</span></span><span class=line><span class=cl>        <span class=n>sql</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;INSERT INTO point_geometry
</span></span></span><span class=line><span class=cl><span class=s2>                    (</span><span class=si>%s</span><span class=s2>, Geometry) VALUES
</span></span></span><span class=line><span class=cl><span class=s2>                    (</span><span class=si>%s</span><span class=s2>, GeomFromText(&#39;</span><span class=si>%s</span><span class=s2>&#39;, 4326));&#34;&#34;&#34;</span> <span class=o>%</span> \
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;,&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__header</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;,&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>__quote_identifier</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                      <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>row</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=n>geometry</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>sql</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=implementarea-procesului-de-geocodificare-propriu-zis>Implementarea procesului de geocodificare propriu-zis</h2><p>Extensia pe care am creato va implementa 4 tipuri de geocodificÄƒri, dupÄƒ cum urmeazÄƒ:</p><ul><li>Geocodificarea strÄƒzii, numÄƒrului casei È™i localitÄƒÈ›ii;</li><li>Geocodificarea strÄƒzii È™i localitÄƒÈ›ii, cÃ¢nd numÄƒrul casei se conÈ›ine Ã®n cÃ¢mpul cu stradÄƒ;</li><li>Geocodificarea intersecÈ›iilor (strada1, strada2, localitate);</li><li>Geocodificarea combinatÄƒ (se alege una din cele menÈ›ionate mai sus, Ã®n dependenÈ›Äƒ de ce cÃ¢mpuri Ã®n fiÈ™ierul CSV sunt suplinite).</li></ul><h3 id=implementarea-metodelor-de-geocodificare-a-rÃ¢ndurilor-csv>Implementarea metodelor de geocodificare a rÃ¢ndurilor CSV</h3><p>Ãn urmÄƒtoarele fragmente de cod, eu am implementat 2 metode ce vor geocodifica strada È™i numÄƒrul casei È™i, respectiv, intersecÈ›ia a douÄƒ strÄƒzi. Aceste metode vor apela la metodele create anterior care comunicÄƒ cu serviciul API Geocodificare al site-ului <a href=https://map.md/ target=_blank rel="noopener noreffer">Map.md</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>__geocode_street_and_house_number</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>row</span><span class=p>,</span> <span class=n>street</span><span class=p>,</span> <span class=n>house_number</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Geocode street1 and house number.
</span></span></span><span class=line><span class=cl><span class=s2>    param row: Row list.
</span></span></span><span class=line><span class=cl><span class=s2>    type row: list of str
</span></span></span><span class=line><span class=cl><span class=s2>    param street: Street.
</span></span></span><span class=line><span class=cl><span class=s2>    type street: str
</span></span></span><span class=line><span class=cl><span class=s2>    param house_number: House number.
</span></span></span><span class=line><span class=cl><span class=s2>    type house_number: str
</span></span></span><span class=line><span class=cl><span class=s2>    :return: Return bool.
</span></span></span><span class=line><span class=cl><span class=s2>    :rtype: bool
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__map_md_search_street</span><span class=p>(</span><span class=n>row</span><span class=p>,</span> <span class=n>street</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>r</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Se obtine lista cu numerele caselor adresei solicitate</span>
</span></span><span class=line><span class=cl>    <span class=n>buildings</span> <span class=o>=</span> <span class=n>r</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;buildings&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Daca numarul casei nu se gaseste in lista,</span>
</span></span><span class=line><span class=cl>    <span class=c1># nu se indeplineste cel de-al doilea request</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>house_number</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>buildings</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__write_notfound_street_to_csv</span><span class=p>(</span><span class=n>row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__map_md_search_street_with_house_number</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>row</span><span class=p>,</span> <span class=n>r</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;id&#39;</span><span class=p>],</span> <span class=n>house_number</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>r</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>geometry</span> <span class=o>=</span> <span class=s2>&#34;POINT(</span><span class=si>%s</span><span class=s2> </span><span class=si>%s</span><span class=s2>)&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=s1>&#39;point&#39;</span><span class=p>][</span><span class=s1>&#39;lon&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                                    <span class=n>r</span><span class=p>[</span><span class=s1>&#39;point&#39;</span><span class=p>][</span><span class=s1>&#39;lat&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>__add_row_to_db</span><span class=p>(</span><span class=n>row</span><span class=p>,</span> <span class=n>geometry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>__geocode_street1_and_street2</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>row</span><span class=p>,</span> <span class=n>street1</span><span class=p>,</span> <span class=n>street2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Geocode street1 and street2.
</span></span></span><span class=line><span class=cl><span class=s2>    param row: Row list.
</span></span></span><span class=line><span class=cl><span class=s2>    type row: list of str
</span></span></span><span class=line><span class=cl><span class=s2>    param street: Street1.
</span></span></span><span class=line><span class=cl><span class=s2>    type street: str
</span></span></span><span class=line><span class=cl><span class=s2>    param street: Street2.
</span></span></span><span class=line><span class=cl><span class=s2>    type street: str
</span></span></span><span class=line><span class=cl><span class=s2>    :return: Return bool.
</span></span></span><span class=line><span class=cl><span class=s2>    :rtype: bool
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Se cauta strada1 pentru a obtine identificatorul ei</span>
</span></span><span class=line><span class=cl>    <span class=n>r1</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__map_md_search_street</span><span class=p>(</span><span class=n>row</span><span class=p>,</span> <span class=n>street1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Se cauta strada2 pentru a obtine identificatorul ei</span>
</span></span><span class=line><span class=cl>    <span class=n>r2</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__map_md_search_street</span><span class=p>(</span><span class=n>row</span><span class=p>,</span> <span class=n>street2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Verificare strada1 si strada2</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>r1</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>r2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Se obtine datele despre strada1 si strada2</span>
</span></span><span class=line><span class=cl>    <span class=n>r1</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__map_md_get_street</span><span class=p>(</span><span class=n>r1</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;id&#39;</span><span class=p>],</span> <span class=n>row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r2</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__map_md_get_street</span><span class=p>(</span><span class=n>r2</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;id&#39;</span><span class=p>],</span> <span class=n>row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>r1</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>r2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r1_geo_json</span> <span class=o>=</span> <span class=n>r1</span><span class=p>[</span><span class=s1>&#39;geo_json&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>r2_geo_json</span> <span class=o>=</span> <span class=n>r2</span><span class=p>[</span><span class=s1>&#39;geo_json&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>s1</span> <span class=o>=</span> <span class=n>shape</span><span class=p>(</span><span class=n>r1_geo_json</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s2</span> <span class=o>=</span> <span class=n>shape</span><span class=p>(</span><span class=n>r2_geo_json</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>s1</span><span class=o>.</span><span class=n>intersects</span><span class=p>(</span><span class=n>s2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__write_notfound_street_to_csv</span><span class=p>(</span><span class=n>row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>geometry</span> <span class=o>=</span> <span class=n>s1</span><span class=o>.</span><span class=n>intersection</span><span class=p>(</span><span class=n>s2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># In cazul ca se identifica MultiPoint,</span>
</span></span><span class=line><span class=cl>    <span class=c1># se ia primul Point in consideratie</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>geometry</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>shapely</span><span class=o>.</span><span class=n>geometry</span><span class=o>.</span><span class=n>multipoint</span><span class=o>.</span><span class=n>MultiPoint</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>geometry</span> <span class=o>=</span> <span class=n>geometry</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>__add_row_to_db</span><span class=p>(</span><span class=n>row</span><span class=p>,</span> <span class=n>geometry</span><span class=o>.</span><span class=n>wkt</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=implementarea-metodei-de-rulare-a-procesului-de-geocodificare>Implementarea metodei de rulare a procesului de geocodificare</h3><p>Pentru a rula procesul de geocodificare, instrucÈ›iunile destinate acestui scop au fost plasate Ã®n metoda <a href=https://qgis.org/pyqgis/master/core/QgsTask.html#qgis.core.QgsTask.run target=_blank rel="noopener noreffer">run</a>, din motiv cÄƒ managerul de sarcini al aplicaÈ›iei QGIS apeleazÄƒ anume aceastÄƒ metodÄƒ cÃ¢nd se adaugÄƒ o sarcinÄƒ nouÄƒ Ã®n acesta (metoda <a href=https://qgis.org/pyqgis/master/core/QgsTaskManager.html#qgis.core.QgsTaskManager.addTask target=_blank rel="noopener noreffer">addTask</a>).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Geocode addresses using Map.md API.
</span></span></span><span class=line><span class=cl><span class=s2>    return: Return bool type.
</span></span></span><span class=line><span class=cl><span class=s2>    type: bool
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>QgsMessageLog</span><span class=o>.</span><span class=n>logMessage</span><span class=p>(</span><span class=s2>&#34;Ãnceput geocodificare.&#34;</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=n>Qgis</span><span class=o>.</span><span class=n>Info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Se initializeaza baza de date SpatiaLite</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>__init_spatialite_db</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pattern</span> <span class=o>=</span> <span class=sa>r</span><span class=s2>&#34;^((?:[a-z0-9ÄƒÃ®È™È›Ã¢]+[\., ]+)+)(\d{1,3}(?:[\/ ]?\w{1,2})?)$&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>__street1_index</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>__locality_index</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>exception</span> <span class=o>=</span> <span class=ne>Exception</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Indicele cÃ¢mpurilor street1 È™i/sau locality sunt goale!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Se omite primul rand, deoarece contine denumirile coloanelor</span>
</span></span><span class=line><span class=cl>    <span class=n>iter_rows</span> <span class=o>=</span> <span class=nb>iter</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>read_csv</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nb>next</span><span class=p>(</span><span class=n>iter_rows</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>index</span><span class=p>,</span> <span class=n>row</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>iter_rows</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>setProgress</span><span class=p>(</span><span class=n>index</span><span class=o>*</span><span class=mi>100</span><span class=o>/</span><span class=bp>self</span><span class=o>.</span><span class=n>__count_csv_lines</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=c1># verificÄƒ isCanceled() pentru a gestiona anularea geocodificÄƒrii</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>isCanceled</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>row</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__street1_index</span><span class=p>]</span> <span class=ow>and</span> \
</span></span><span class=line><span class=cl>                <span class=ow>not</span> <span class=n>row</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__locality_index</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>__write_notfound_street_to_csv</span><span class=p>(</span><span class=n>row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>__street2_index</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1</span> <span class=ow>and</span> \
</span></span><span class=line><span class=cl>                <span class=n>row</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__street2_index</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>QgsMessageLog</span><span class=o>.</span>\
</span></span><span class=line><span class=cl>                <span class=n>logMessage</span><span class=p>(</span><span class=s2>&#34;Street1 + Street2 + Locality&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>level</span><span class=o>=</span><span class=n>Qgis</span><span class=o>.</span><span class=n>Info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>geocode_street1_and_street2</span> <span class=o>=</span> \
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>__geocode_street1_and_street2</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>row</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>row</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__street1_index</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=n>row</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__street2_index</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>geocode_street1_and_street2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>__house_number_index</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1</span> <span class=ow>and</span> \
</span></span><span class=line><span class=cl>                <span class=n>row</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__house_number_index</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>QgsMessageLog</span><span class=o>.</span>\
</span></span><span class=line><span class=cl>                <span class=n>logMessage</span><span class=p>(</span><span class=s2>&#34;Street1 + House number + Locality&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>level</span><span class=o>=</span><span class=n>Qgis</span><span class=o>.</span><span class=n>Info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>geocode_street_and_house_number</span> <span class=o>=</span> \
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>__geocode_street_and_house_number</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>row</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>row</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__street1_index</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=n>row</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__house_number_index</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>geocode_street_and_house_number</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>QgsMessageLog</span><span class=o>.</span><span class=n>logMessage</span><span class=p>(</span><span class=s2>&#34;Street1 + Locality&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                        <span class=n>level</span><span class=o>=</span><span class=n>Qgis</span><span class=o>.</span><span class=n>Info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                <span class=n>row</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>__street1_index</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                                <span class=n>re</span><span class=o>.</span><span class=n>IGNORECASE</span> <span class=o>|</span> <span class=n>re</span><span class=o>.</span><span class=n>UNICODE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>__write_notfound_street_to_csv</span><span class=p>(</span><span class=n>row</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>street</span> <span class=o>=</span> <span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>house_number</span> <span class=o>=</span> <span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>geocode_street_and_house_number</span> <span class=o>=</span> \
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>__geocode_street_and_house_number</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>row</span><span class=p>,</span> <span class=n>street</span><span class=p>,</span> <span class=n>house_number</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>geocode_street_and_house_number</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>True</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=implementarea-metodei-de-finisare-a-procesului-de-geocodificare>Implementarea metodei de finisare a procesului de geocodificare</h3><p>Clasa QgsTask mai implementeazÄƒ o metodÄƒ denumitÄƒ <a href=https://qgis.org/pyqgis/master/core/QgsTask.html#qgis.core.QgsTask.finished target=_blank rel="noopener noreffer">finished</a>, care va fi apelatÄƒ dupÄƒ finalizarea sarcinii (fie prin finalizare cu succes, fie prin anulare la cererea utilizatorului). Argumentul <em>result</em> reflectÄƒ dacÄƒ sarcina a fost finalizatÄƒ cu succes sau nu. AceastÄƒ metodÄƒ este Ã®ntotdeauna apelatÄƒ de la thread-ul principal, deci se permite de a adÄƒuga stratul cu puncte geocodificate Ã®n aplicaÈ›ie.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>finished</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>result</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function is automatically called when the task has
</span></span></span><span class=line><span class=cl><span class=s2>    completed (successfully or not).
</span></span></span><span class=line><span class=cl><span class=s2>    You implement finished() to do whatever follow-up stuff
</span></span></span><span class=line><span class=cl><span class=s2>    should happen after the task is complete.
</span></span></span><span class=line><span class=cl><span class=s2>    finished is always called from the main thread, so it&#39;s safe
</span></span></span><span class=line><span class=cl><span class=s2>    to do GUI operations and raise Python exceptions here.
</span></span></span><span class=line><span class=cl><span class=s2>    result is the return value from self.run.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Se adauga stratul in QGIS</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__add_spatialite_layer_to_qgis</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>csv_row_count</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__count_csv_lines</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>QgsMessageLog</span><span class=o>.</span><span class=n>logMessage</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;SfÃ¢rÈ™it geocodificare.&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Au fost geocodificate </span><span class=si>%i</span><span class=s2> din </span><span class=si>%i</span><span class=s2> adrese.&#34;</span> <span class=o>%</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=n>csv_row_count</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>__not_found_count</span><span class=p>,</span> <span class=n>csv_row_count</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>level</span><span class=o>=</span><span class=n>Qgis</span><span class=o>.</span><span class=n>Success</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>exception</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Se adauga stratul in QGIS</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>__add_spatialite_layer_to_qgis</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>QgsMessageLog</span><span class=o>.</span><span class=n>logMessage</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Geocodificarea a fost anulatÄƒ. &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Se afiÈ™eazÄƒ rezultatele obÈ›inute pÃ¢nÄƒ la moment.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>level</span><span class=o>=</span><span class=n>Qgis</span><span class=o>.</span><span class=n>Warning</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>QgsMessageLog</span><span class=o>.</span><span class=n>logMessage</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Procesul de geocodificare a returnat o excepÈ›ie:</span><span class=se>\n</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span>
</span></span><span class=line><span class=cl>            <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>exception</span><span class=p>),</span> <span class=n>level</span><span class=o>=</span><span class=n>Qgis</span><span class=o>.</span><span class=n>Critical</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=bp>self</span><span class=o>.</span><span class=n>exception</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=implementarea-logicii-pentru-interfaÈ›a-dialogul-de-geocodificare>Implementarea logicii pentru interfaÈ›a dialogul de geocodificare</h2><p>InterfaÈ›a dialogului extensiei creatÄƒ anterior este lipsitÄƒ de un oarecare funcÈ›ional, cu alte cuvinte nu implementeazÄƒ nici-o logicÄƒ. E timpul sÄƒ reparÄƒm acest lucru ğŸ¤—.</p><h3 id=importarea-bibliotecilor-necesare>Importarea bibliotecilor necesare</h3><p>Ãn primul rÃ¢nd, ne asigurÄƒm cÄƒ am importat tot de ce vom avea nevoie pe parcurs:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PyQt5</span> <span class=kn>import</span> <span class=n>uic</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PyQt5</span> <span class=kn>import</span> <span class=n>QtWidgets</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PyQt5.QtWidgets</span> <span class=kn>import</span> <span class=n>QFileDialog</span><span class=p>,</span> <span class=n>QDialogButtonBox</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.map_md_utils</span> <span class=kn>import</span> <span class=n>MapMdUtils</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=asigurarea-conexiunii-evenimentelor-cu-metodele-respective>Asigurarea conexiunii evenimentelor cu metodele respective</h3><p>Ulterior, la constructorul clasei MapMdDialog, implementÄƒm conexiunile evenimentelor de modificare a textului, de apÄƒsare click pe butoane cu metodele corespunzÄƒtoare.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>button_box</span><span class=o>.</span><span class=n>button</span><span class=p>(</span><span class=n>QDialogButtonBox</span><span class=o>.</span><span class=n>Ok</span><span class=p>)</span><span class=o>.</span><span class=n>setEnabled</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ConectÄƒm evenimentele de modificare a textului cu metoda ce va</span>
</span></span><span class=line><span class=cl><span class=c1># activa butonul OK.</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>input_filename</span><span class=o>.</span><span class=n>textChanged</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>is_ready_to_geocode</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>output_spatialite_filename</span><span class=o>.</span><span class=n>textChanged</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>is_ready_to_geocode</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>output_notfound_filename</span><span class=o>.</span><span class=n>textChanged</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>is_ready_to_geocode</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>api_key</span><span class=o>.</span><span class=n>textChanged</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>is_ready_to_geocode</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>street_field1</span><span class=o>.</span><span class=n>currentTextChanged</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>is_ready_to_geocode</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>locality_field</span><span class=o>.</span><span class=n>currentTextChanged</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>is_ready_to_geocode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Conectarea evenimentelor click pe butoane cu metodele ce vor</span>
</span></span><span class=line><span class=cl><span class=c1># afiÈ™a dialoguri de deschidere/salvare a fiÈ™ierelor.</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>browse_infile</span><span class=o>.</span><span class=n>clicked</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>browse_infile_dialog</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>browse_spatialite</span><span class=o>.</span><span class=n>clicked</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>browse_spatialite_file_dialog</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>browse_notfound</span><span class=o>.</span><span class=n>clicked</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>browse_notfound_file_dialog</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=implementarea-metodei-de-alegere-a-fiÈ™ierului-de-intrare>Implementarea metodei de alegere a fiÈ™ierului de intrare</h3><p>Ãn fragmentul de cod ce urmeazÄƒ, este implementat funcÈ›ionalul de alegere a fiÈ™ierului de intrare de tip CSV UTF-8. Pentru aceasta, dupÄƒ apÄƒsarea click pe primul buton <em>Browseâ€¦</em>, se va afiÈ™a dialogul de deschidere a fiÈ™ierului.</p><p>DupÄƒ alegerea fiÈ™ierului de intrare, Ã®n cÃ¢mpul fiÈ™ierului de ieÈ™ire se va salva calea absolutÄƒ a fiÈ™ierului de intrare, aceeaÈ™i denumire ca È™i fiÈ™ierul de intrare + extensia <em>.db</em>, iar Ã®n cÃ¢mpul fiÈ™ierului cu adrese neidentificate â€“ calea absolutÄƒ a fiÈ™ierului de intrare cu denumirea fiÈ™ierului <em>notfound.csv</em>.</p><p>DupÄƒ aceasta, toate elementele combobox vor fi suplinite cu denumirile coloanelor fiÈ™ierului de intrare, pentru a permite utilizatorului de a asocia cÃ¢mpurile extensiei cu coloanele din fiÈ™ierul de intrare.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>browse_infile_dialog</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Browse input CSV file dialog &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>input_file_name</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>QFileDialog</span><span class=o>.</span><span class=n>getOpenFileName</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;Address CSV Input File&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>input_filename</span><span class=o>.</span><span class=n>displayText</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;CSV File (*.csv *.txt)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>input_file_name</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>input_file_name</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>abspath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=n>input_file_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># Se seteaza calea fisierului de intrare</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>input_filename</span><span class=o>.</span><span class=n>setText</span><span class=p>(</span><span class=n>abspath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># Se seteaza calea spre fisierul de iesire (SpatiaLite)</span>
</span></span><span class=line><span class=cl>        <span class=c1># Se inlocuieste extensia &#39;.csv&#39; cu &#39;.db&#39;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>output_spatialite_filename</span><span class=o>.</span><span class=n>setText</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>abspath</span><span class=p>),</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>abspath</span><span class=p>))[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=s1>&#39;.db&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># Se seteaza calea spre fisierul CSV cu adrese neidentificate</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>output_notfound_filename</span><span class=o>.</span><span class=n>setText</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>abspath</span><span class=p>),</span> <span class=s1>&#39;notfound.csv&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>combolist</span> <span class=o>=</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>street_field1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>street_field2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>house_number_field</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>locality_field</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>box</span> <span class=ow>in</span> <span class=n>combolist</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>box</span><span class=o>.</span><span class=n>clear</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>box</span><span class=o>.</span><span class=n>addItem</span><span class=p>(</span><span class=s2>&#34;(none)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>box</span><span class=o>.</span><span class=n>setCurrentIndex</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>map_md_utils</span> <span class=o>=</span> <span class=n>MapMdUtils</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>input_filename</span><span class=o>.</span><span class=n>displayText</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>header</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>map_md_utils</span><span class=o>.</span><span class=n>read_csv</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=n>header</span> <span class=o>=</span> <span class=p>[</span><span class=n>field</span> <span class=k>for</span> <span class=n>field</span> <span class=ow>in</span> <span class=n>header</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>header</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>index</span> <span class=ow>in</span> <span class=n>header</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>box</span> <span class=ow>in</span> <span class=n>combolist</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>box</span><span class=o>.</span><span class=n>addItem</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>StopIteration</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=implementarea-metodei-de-alegere-a-cÄƒilor-spre-fiÈ™ierele-de-ieÈ™ire>Implementarea metodei de alegere a cÄƒilor spre fiÈ™ierele de ieÈ™ire</h3><p>Cum am menÈ›ionat anterior, dupÄƒ alegerea fiÈ™ierului de intrare, Ã®n mod implicit se modificÄƒ È™i calea spre fiÈ™ierele de ieÈ™ire È™i a celui ce conÈ›ine adrese neidentificate, Ã®nsÄƒ aceste cÄƒi (precum È™i denumirea fiÈ™ierelor) pot fi modificate la cererea utilizatorului, apÄƒsÃ¢nd pe butoanele <em>Browseâ€¦</em> Ã®n drept cu cÃ¢mpurile menÈ›ionate.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>browse_spatialite_file_dialog</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Browse SpatiaLite file dialog. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>output_file_name</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>QFileDialog</span><span class=o>.</span><span class=n>getSaveFileName</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;Output SpatiaLite File&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>output_spatialite_filename</span><span class=o>.</span><span class=n>displayText</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;SpatiaLite File (*.db *.sqlite)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>output_file_name</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>output_spatialite_filename</span><span class=o>.</span><span class=n>setText</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=n>output_file_name</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>browse_notfound_file_dialog</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Browse Not Found file dialog. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>output_file_name</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>QFileDialog</span><span class=o>.</span><span class=n>getSaveFileName</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;Output Not Found File&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>output_notfound_filename</span><span class=o>.</span><span class=n>displayText</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;CSV File (*.csv *.txt)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>output_file_name</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>output_notfound_filename</span><span class=o>.</span><span class=n>setText</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=n>output_file_name</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=verificarea-disponibilitÄƒÈ›ii-procedurii-de-geocodificare>Verificarea disponibilitÄƒÈ›ii procedurii de geocodificare</h3><ul><li>CÃ¢mpul cu calea spre fiÈ™ierul de intrare sÄƒ nu fie gol;</li><li>CÃ¢mpul cu calea spre fiÈ™ierul de ieÈ™ire sÄƒ nu fie gol;</li><li>CÃ¢mpul cu cheia API sÄƒ nu fie gol;</li><li>Componentul combobox cu denumirea <em>Street 1 field</em> sÄƒ nu fie gol;</li><li>Componentul combobox cu denumirea <em>Locality field</em> sÄƒ nu fie gol.</li></ul><p>DupÄƒ satisfacerea acestor condiÈ›ii, butonul <em>OK</em> al interfeÈ›ei dialogului extensiei va fi pornit È™i va fi posibil de apÄƒsat.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>is_ready_to_geocode</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Enable or disable OK button whether all
</span></span></span><span class=line><span class=cl><span class=s2>    required field are filled. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>is_ready</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>input_filename</span><span class=o>.</span><span class=n>displayText</span><span class=p>()</span> \
</span></span><span class=line><span class=cl>        <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>output_spatialite_filename</span><span class=o>.</span><span class=n>displayText</span><span class=p>()</span> \
</span></span><span class=line><span class=cl>        <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>output_notfound_filename</span><span class=o>.</span><span class=n>displayText</span><span class=p>()</span> \
</span></span><span class=line><span class=cl>        <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>api_key</span><span class=o>.</span><span class=n>displayText</span><span class=p>()</span> \
</span></span><span class=line><span class=cl>        <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>street_field1</span><span class=o>.</span><span class=n>currentIndex</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span> \
</span></span><span class=line><span class=cl>        <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>locality_field</span><span class=o>.</span><span class=n>currentIndex</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>button_box</span><span class=o>.</span><span class=n>button</span><span class=p>(</span><span class=n>QDialogButtonBox</span><span class=o>.</span><span class=n>Ok</span><span class=p>)</span><span class=o>.</span><span class=n>setEnabled</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nb>bool</span><span class=p>(</span><span class=n>is_ready</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=modificarea-fiÈ™ierului-principal-al-extensiei>Modificarea fiÈ™ierului principal al extensiei</h2><p>Ãn fiÈ™ierul <em>map_md.py</em> ne asigurÄƒm cÄƒ am importat urmÄƒtoarele biblioteci:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os.path</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PyQt5.QtCore</span> <span class=kn>import</span> <span class=n>QSettings</span><span class=p>,</span> <span class=n>QTranslator</span><span class=p>,</span> <span class=n>qVersion</span><span class=p>,</span> <span class=n>QCoreApplication</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PyQt5.QtGui</span> <span class=kn>import</span> <span class=n>QIcon</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PyQt5.QtWidgets</span> <span class=kn>import</span> <span class=n>QAction</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>qgis.core</span> <span class=kn>import</span> <span class=n>QgsApplication</span><span class=p>,</span> <span class=n>QgsMessageLog</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.resources</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.map_md_dialog</span> <span class=kn>import</span> <span class=n>MapMdDialog</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.map_md_utils</span> <span class=kn>import</span> <span class=n>MapMdUtils</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=obÈ›inerea-datelor-din-interfaÈ›a-dialogului-extensiei-È™i-adÄƒugarea-procesului-de-geocodificare-Ã®n-managerul-de-sarcini>ObÈ›inerea datelor din interfaÈ›a dialogului extensiei È™i adÄƒugarea procesului de geocodificare Ã®n managerul de sarcini</h3><p>Ãn constructorul clasei <em>MapMd</em>, atribuim o variabilÄƒ care va obÈ›ine obiectul managerului de sarcini al aplicaÈ›iei QGIS.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>task_manager</span> <span class=o>=</span> <span class=n>QgsApplication</span><span class=o>.</span><span class=n>taskManager</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Ulterior, dacÄƒ a fost apÄƒsat butonul <em>OK</em> din interfaÈ›a dialogului extensiei, atunci se obÈ›ine toÈ›i parametrii setaÈ›i Ã®n aceasta, se creazÄƒ o nouÄƒ instanÈ›Äƒ a clasei <em>MapMdUtils</em>, care extinde clasa <em>QgsTask</em> È™i o transmite metodei <em>addTask</em> a obiectului <em>taskManager</em>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># Init variables</span>
</span></span><span class=line><span class=cl>    <span class=n>api_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dlg</span><span class=o>.</span><span class=n>api_key</span><span class=o>.</span><span class=n>displayText</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>street1_index</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dlg</span><span class=o>.</span><span class=n>street_field1</span><span class=o>.</span><span class=n>currentIndex</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>street2_index</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dlg</span><span class=o>.</span><span class=n>street_field2</span><span class=o>.</span><span class=n>currentIndex</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>house_number_index</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dlg</span><span class=o>.</span><span class=n>house_number_field</span><span class=o>.</span><span class=n>currentIndex</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>locality_index</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dlg</span><span class=o>.</span><span class=n>locality_field</span><span class=o>.</span><span class=n>currentIndex</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>input_filename</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dlg</span><span class=o>.</span><span class=n>input_filename</span><span class=o>.</span><span class=n>displayText</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>output_filename</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dlg</span><span class=o>.</span><span class=n>output_spatialite_filename</span><span class=o>.</span><span class=n>displayText</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>notfound_filename</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dlg</span><span class=o>.</span><span class=n>output_notfound_filename</span><span class=o>.</span><span class=n>displayText</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>map_md_utils</span> <span class=o>=</span> <span class=n>MapMdUtils</span><span class=p>(</span><span class=n>input_filename</span><span class=p>,</span> <span class=n>output_filename</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                              <span class=n>notfound_filename</span><span class=p>,</span> <span class=n>api_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                              <span class=n>street1_index</span><span class=p>,</span> <span class=n>street2_index</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                              <span class=n>house_number_index</span><span class=p>,</span> <span class=n>locality_index</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Geocoding CSV rows</span>
</span></span><span class=line><span class=cl>    <span class=n>task_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>task_manager</span><span class=o>.</span><span class=n>addTask</span><span class=p>(</span><span class=n>map_md_utils</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>QgsMessageLog</span><span class=o>.</span><span class=n>logMessage</span><span class=p>(</span><span class=s2>&#34;AtribuitÄƒ sarcinÄƒ nr. </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=nb>str</span><span class=p>(</span><span class=n>task_id</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=Ã®ncheire>Ãncheire</h2><p>La primele testÄƒri, aceastÄƒ extensie funcÈ›ioneazÄƒ bine. Extensia o puteÈ›i gÄƒsi pe <a href=https://plugins.qgis.org/plugins/map_md/ target=_blank rel="noopener noreffer">depozitul Plugin-urilor QGIS</a> sau pe <a href=https://github.com/victor-pogor/map.md-geocoding target=_blank rel="noopener noreffer">repository oficial Github</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Actualizat la 2020-08-09&nbsp;<a class=git-hash href=https://github.com/sunt-programator/sunt-programator-site/commit/1933f4a95d160364fbf47857e3dde6e4eb30a23f target=_blank title="commit by Victor Pogor(victor.pogor@outlook.com) 1933f4a95d160364fbf47857e3dde6e4eb30a23f: post: minor changes">
<i class="fas fa-hashtag fa-fw"></i>1933f4a</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/index.md target=_blank>Citire Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Distribuie pe Twitter" data-sharer=twitter data-url=http://suntprogramator.dev/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/ data-title="QGIS Plugin: Implementarea serviciului Map.md API" data-hashtags=pyqgis,pyqt5,python,qgis><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Distribuie pe Facebook" data-sharer=facebook data-url=http://suntprogramator.dev/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/ data-hashtag=pyqgis><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Distribuie pe Linkedin" data-sharer=linkedin data-url=http://suntprogramator.dev/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Distribuie pe WhatsApp" data-sharer=whatsapp data-url=http://suntprogramator.dev/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/ data-title="QGIS Plugin: Implementarea serviciului Map.md API" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="Distribuie pe VK" data-sharer=vk data-url=http://suntprogramator.dev/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/ data-title="QGIS Plugin: Implementarea serviciului Map.md API" data-image=/images/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/maxresdefault.jpg><i class="fab fa-vk fa-fw"></i></a><a href=javascript:void(0); title="Distribuie pe OK.RU" data-sharer=okru data-url=http://suntprogramator.dev/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/ data-title="QGIS Plugin: Implementarea serviciului Map.md API"><i class="fab fa-odnoklassniki fa-fw"></i></a><a href=javascript:void(0); title="Distribuie pe Evernote" data-sharer=evernote data-url=http://suntprogramator.dev/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/ data-title="QGIS Plugin: Implementarea serviciului Map.md API"><i class="fab fa-evernote fa-fw"></i></a><a href=javascript:void(0); title="Distribuie pe Skype" data-sharer=skype data-url=http://suntprogramator.dev/2019/08/qgis-plugin-implementarea-serviciului-map-md-api/ data-title="QGIS Plugin: Implementarea serviciului Map.md API"><i class="fab fa-skype fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/pyqgis/>pyqgis</a>,&nbsp;<a href=/tags/pyqt5/>pyqt5</a>,&nbsp;<a href=/tags/python/>python</a>,&nbsp;<a href=/tags/qgis/>qgis</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Ãnapoi</a></span>&nbsp;|&nbsp;<span><a href=/>AcasÄƒ</a></span></section></div><div class=post-nav><a href=/2020/08/latex-involute-of-a-circle/ class=next rel=next title="LaTeX: Proiectarea È™i animarea evolventei unui cerc">LaTeX: Proiectarea È™i animarea evolventei unui cerc<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Realizat de cÄƒtre <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.100.2">Hugo</a> | TemÄƒ - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://suntprogramator.dev/ target=_blank>Victor Pogor</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Ãnapoi Sus"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="Vizualizare Comentarii"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"CopiaÈ›i Ã®n clipboard",maxShownLines:10},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"post-comment",lightTheme:"github-light",repo:"sunt-programator/sunt-programator-site"}},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"4A20M7PBC9",algoliaIndex:"SUNT_PROGRAMATOR_RO",algoliaSearchKey:"4191092b0e773be76573fa4f7b22a8b7",highlightTag:"em",maxResultLength:10,noResultsFound:"Nici un rezultat gasit",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-174142374-1',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-174142374-1" async></script></body></html>